<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>interview page</title>
</head>

<style>
    a {
        text-decoration-line: none;
        color: white;
    }
    
    .left-menu {
        float: left;
        width: 130px;
        height: 100%;
        border-right: 1px solid rgb(119, 119, 119);
        text-align: center;
        padding: 0;
    }
    
    .left-menu ul {
        padding: 0;
    }
    
    .left-menu li {
        list-style-type: none;
        width: 100%;
        height: 100px;
        padding-top: 60px;
        border-bottom: 1px rgb(119, 119, 119) solid;
        cursor: pointer;
    }
    
    .left-menu li:hover {
        background-color: #ff69b4;
    }
    
    .left-menu h3 {
        margin: 0;
    }
    
    .sub-menu {
        margin: 0;
    }
    
    .main {
        margin-left: 130px;
        height: 100vh;
        padding: 20px;
        color: white;
    }
    
    button {
        padding: 10px;
        margin: 10px 0;
        background-color: #ff69b4;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
    }
    
    button:hover {
        background-color: #ff1493;
    }
    
    #select-interview {
        background-image: url('interviewer.jpg');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        height: 100vh;
        display: none;
        /* 기본적으로 숨김 */
    }
    
    #resume-select {
        display: block;
        /* 기본적으로 보임 */
    }
    
    #select-interview-check {
        display: none;
        /* 기본적으로 숨김 */
    }
    
    #webcam {
        width: 300px;
        position: absolute;
        top: 200px;
        right: 20px;
    }
    /* 자막 css */
    
    .cc {
        position: absolute;
        top: 800px;
    }
    
    #stop-recording {
        width: 100px;
        position: absolute;
        right: 20px;
        top: 800px;
    }
    /* 테이블 전체 스타일 */
    
    #resumeTable {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    /* 테이블 헤더 스타일 */
    
    #resumeTable thead th {
        background-color: #ff69b4;
        /* 핑크 */
        color: white;
        padding: 10px;
        text-align: center;
        font-size: 18px;
        border: 2px solid black;
    }
    /* 테이블 본문 스타일 */
    
    #resumeTable tbody td {
        background-color: black;
        color: white;
        padding: 10px;
        text-align: center;
        font-size: 16px;
        border: 2px solid #ff69b4;
        /* 핑크 테두리 */
    }
    /* tr 전체에 hover 효과 적용 */
    
    #resumeTable tbody tr:hover td {
        background-color: #ff1493;
        /* 진한 핑크 */
        color: white;
    }
    /* 테이블 행 간격 */
    
    #resumeTable tbody tr {
        height: 50px;
    }
</style>

<body>

    <div id="header"></div>

    <div class="left-menu">
        <ul class="sub-menu">
            <li id="view-interview">
                <h3>면접보기</h3>
            </li>
            <li id="view-records">
                <h3>&nbsp;면접 기록 조회</h3>
            </li>
        </ul>
    </div>

    <div class="main" id="resume-select">
        <h1>면접보기</h1>
        <p>이력서 선택 후 면접이 시작됩니다. 면접 과정은 자동으로 녹화됩니다.</p>

        <table style="border: 1px solid white;">
            <tr>
                <td>이력서 1</td>
            </tr>
        </table>
        <button id="select-resume">선택</button>

    </div>

    <div class="main" id="select-interview">
        <video id="webcam" autoplay playsinline></video>
        <p class="cc">면접관 질문 자막</p>
        <button id="stop-recording">녹화 종료</button>
    </div>

    <div class="main" id="select-interview-check">
        <h1>면접 기록 조회</h1>
        <table id="resumeTable">
            <thead>
                <tr>
                    <th>순번</th>
                    <th>제목</th>
                    <th>날짜</th>
                    <th>영상 길이</th>
                </tr>
            </thead>
            <tbody>
                <!-- JavaScript로 이력서 정보를 여기 출력 -->
            </tbody>
        </table>
    </div>
    <div class="main" id="interview-recording-play" style="display: none;">
        <h1>영상 재생</h1>
        <video id="videoPlayer" width="600" controls>
            <source id="videoSource" src="" type="video/mp4">
            당신의 브라우저는 비디오 태그를 지원하지 않습니다.
        </video>
    </div>



    <script>
        // header.html 파일을 불러와서 #header div에 삽입
        fetch('header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header').innerHTML = data;
            });

        const selectResumeButton = document.getElementById('select-resume');
        const resumeSelectSection = document.getElementById('resume-select');
        const selectInterviewSection = document.getElementById('select-interview');
        const viewRecordsButton = document.getElementById('view-records');
        const selectInterviewCheckSection = document.getElementById('select-interview-check');
        const video = document.getElementById('webcam');
        const downloadLink = document.getElementById('downloadLink');
        let stream;
        let mediaRecorder;
        let recordedChunks = [];

        // 면접보기 클릭 시 면접 페이지로 이동
        const viewInterviewButton = document.getElementById('view-interview');
        viewInterviewButton.addEventListener('click', () => {
            resumeSelectSection.style.display = 'block';
            selectInterviewSection.style.display = 'none';
            selectInterviewCheckSection.style.display = 'none';
        });

        // 이력서 선택 후 면접 시작
        selectResumeButton.addEventListener('click', async() => {
            // 이력서 선택 후 화면 전환
            resumeSelectSection.style.display = 'none';
            selectInterviewSection.style.display = 'block';

            try {
                // 웹캠 스트림 가져오기
                stream = await navigator.mediaDevices.getUserMedia({
                    video: true,
                    audio: true
                });
                video.srcObject = stream;

                // 녹화 시작
                recordedChunks = [];
                mediaRecorder = new MediaRecorder(stream);

                mediaRecorder.ondataavailable = function(event) {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };

                mediaRecorder.onstop = function() {
                    const blob = new Blob(recordedChunks, {
                        type: 'video/webm'
                    });
                    const url = URL.createObjectURL(blob);
                    downloadLink.href = url;
                    downloadLink.download = 'interview_recording.webm';
                    downloadLink.style.display = 'block'; // 다운로드 링크 표시
                    downloadLink.textContent = '녹화 영상 다운로드';
                };

                mediaRecorder.start();
                console.log('녹화 시작');
            } catch (err) {
                console.error('웹캠 접근 오류: ', err);
            }
        });

        // 면접 기록 조회 클릭 시 'select-interview-check' 보여주기
        viewRecordsButton.addEventListener('click', () => {
            resumeSelectSection.style.display = 'none';
            selectInterviewSection.style.display = 'none';
            selectInterviewCheckSection.style.display = 'block';
        });

        const stopRecordingButton = document.getElementById('stop-recording');

        stopRecordingButton.addEventListener('click', () => {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
                console.log('녹화 종료');
            }
        });
    </script>

    <!-- 면접 기록 조회 js로 가져오기 -->
    <script>
        const resumeData = [{
            id: 1,
            title: '첫번째 면접 !',
            date: '2024-09-20',
            duration: '10:00',
            videoUrl: 'video1.mp4'
        }, {
            id: 2,
            title: '두번째 면접',
            date: '2024-09-19',
            duration: '15:30',
            videoUrl: 'video2.mp4'
        }, {
            id: 3,
            title: '면접 망했다;;',
            date: '2024-09-18',
            duration: '12:45',
            videoUrl: 'video3.mp4'
        }];

        function displayResumeData() {
            const tableBody = document.querySelector('#resumeTable tbody');
            tableBody.innerHTML = ''; // 기존 내용을 초기화
            resumeData.forEach((resume, index) => {
                const row = document.createElement('tr');

                const idCell = document.createElement('td');
                idCell.textContent = index + 1;
                row.appendChild(idCell);

                const titleCell = document.createElement('td');
                titleCell.textContent = resume.title;
                titleCell.style.cursor = 'pointer';
                titleCell.addEventListener('click', () => {
                    loadVideo(resume.videoUrl); // 영상 재생 함수 호출
                });
                row.appendChild(titleCell);

                const dateCell = document.createElement('td');
                dateCell.textContent = resume.date;
                row.appendChild(dateCell);

                const durationCell = document.createElement('td');
                durationCell.textContent = resume.duration;
                row.appendChild(durationCell);

                tableBody.appendChild(row);
            });
        }

        function loadVideo(videoUrl) {
            // 면접 기록 섹션을 숨기고 영상 재생 섹션을 표시
            document.getElementById('select-interview-check').style.display = 'none';
            document.getElementById('interview-recording-play').style.display = 'block';

            // 비디오 소스를 변경하고 재생
            const videoSource = document.getElementById('videoSource');
            videoSource.src = videoUrl;

            const videoPlayer = document.getElementById('videoPlayer');
            videoPlayer.load();
            videoPlayer.play();
        }

        document.addEventListener('DOMContentLoaded', displayResumeData);
    </script>


</body>

</html>